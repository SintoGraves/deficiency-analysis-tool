<!--
  File: /docs/blue-sheet-demo.html
  Blue Sheet Builder (Demo) — Updated & Heavily Labeled
  --------------------------------------------------------------------
  PURPOSE (Demo):
    - Show how a user fills structured “data blocks” and generates a standards-shaped Blue Sheet.
    - Guidance text is shown first (pink italics + black example context).
    - Preview does NOT change while typing.
    - When the user clicks "Generate Preview", guidance disappears and user input replaces it.

  KEY FEATURES IMPLEMENTED:
    1) Back-to-Flow Diagrams button restored to the ORIGINAL location:
       - Global page header (top band), right-aligned.
    2) Risk Matrix (Figure X) appears AFTER Paragraph 5 in the preview:
       - Only the selected cell is colored (Red/Yellow/Green based on computed risk).
       - Grid lines are grey.
       - TEIN + PM mitigation letter displayed in selected cell (e.g., TEIN-DEMO-M).
       - Figure numbering supports Para 2 figure: if user attaches a figure, it becomes Figure 1; risk matrix becomes Figure 2.
    3) Risk cube:
       - Centered horizontally
       - Width constrained (default 3.0in; adjustable via --risk-w)
    4) Para 2 figure upload:
       - Includes a “sample location” preview and actual file upload workflow.
       - Uploaded image appears inside Para 2 section in the generated preview.
    5) Save to DOCX:
       - Uses a minimal client-side HTML->DOCX approach via Word-compatible HTML (.doc).
       - This is suitable for a demo POC; full build can migrate to a true .docx library/template.
    6) Tense/format indicators:
       - Lightweight checks + visual indicators for each paragraph.
       - Uses browser spellcheck on textareas.
       - Checks are advisory (non-blocking).

  NOTES:
    - This file is self-contained (no external CSS/JS required).
    - Link back assumes flow diagrams page is /docs/index.html. Adjust if needed.

  CHANGE SUMMARY (31 Dec 2025 / 01 Jan 2026):
    - Paragraph 2 split into three separate input blocks (2a/2b/2c) for authoring.
    - GENERATED preview stitches 2a + 2b + 2c into a single Paragraph 2 body (NO 2a/2b/2c labels).
    - Paragraph 2 title does NOT include "(*)".
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blue Sheet Builder (Demo)</title>

  <!-- ============================================================
       SECTION: GLOBAL STYLES / THEME TOKENS
       ============================================================ -->
  <style>
    :root{
      /* --- Palette --- */
      --border: rgba(0,0,0,.14);
      --muted: rgba(0,0,0,.65);
      --ink: #111;
      --guidance: #FF33CC; /* RGB(255,51,204) */
      --gridline: rgba(0,0,0,.35);

      /* --- Risk colors (selected cell only) --- */
      --risk-low:  #2f7a3e;   /* green-ish */
      --risk-med:  #c79100;   /* yellow-ish */
      --risk-high: #a21724;   /* red-ish */

      /* --- Print geometry (Blue Sheet feel) --- */
      --page-w: 8.5in;
      --page-h: 11in;
      --margin: 1in;
      --usable-w: 6.5in;  /* 8.5 - 2*1 */
      --risk-w: 3.0in;    /* centered cube width */

      /* --- UI layout --- */
      --ui-max: 1180px;
    }

    /* ============================================================
       SECTION: APP FRAME / HEADER (BACK BUTTON ORIGINAL LOCATION)
       ============================================================ */
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
      color: var(--ink);
      background: #fff;
    }

    header {
      padding: 16px 18px;
      border-bottom: 1px solid var(--border);
      background: #fff;

      /* Sticky header improves demo UX */
      position: sticky;
      top: 0;
      z-index: 10;
    }

    /* Header layout scaffold: title left, back button right */
    .header-row{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:16px;
    }
    .header-left{ flex: 1 1 auto; min-width: 0; }
    .header-right{ flex: 0 0 auto; padding-top: 2px; }

    header h1 { margin: 0 0 6px; font-size: 18px; }
    header p  { margin: 0; color: var(--muted); font-size: 13px; line-height: 1.35; }

    /* Back button: matches app buttons */
    .btn-link{
      border: 1px solid var(--border);
      background: #f7f7f7;
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 13px;
      cursor: pointer;
      white-space: nowrap;
    }

    /* ============================================================
       SECTION: PAGE LAYOUT (INPUTS LEFT / PREVIEW RIGHT)
       ============================================================ */
    .wrap { max-width: var(--ui-max); margin: 0 auto; padding: 16px 18px; }
    .grid { display: grid; grid-template-columns: 460px 1fr; gap: 14px; align-items: start; }
    @media (max-width: 1100px) {
      .grid { grid-template-columns: 1fr; }
      header{ position: static; }
    }

    .card { border: 1px solid var(--border); border-radius: 12px; padding: 14px; background: #fff; }
    .card h2 { margin: 0; font-size: 14px; }
    .hr { border-top: 1px solid var(--border); margin: 12px 0; }

    /* ============================================================
       SECTION: FORM CONTROLS
       ============================================================ */
    label { display: block; font-size: 12px; color: var(--muted); margin: 0 0 6px; }
    input, select, textarea {
      width: 100%; box-sizing: border-box;
      border: 1px solid var(--border); border-radius: 10px;
      padding: 10px; font-size: 13px; background: #fff;
    }
    textarea { min-height: 86px; resize: vertical; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .row3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }

    .btnbar { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
    button {
      border: 1px solid var(--border);
      background: #f7f7f7; border-radius: 10px;
      padding: 10px 12px; font-size: 13px; cursor: pointer;
    }
    button.primary { background: #111; color: #fff; border-color: #111; }
    button.danger  { background: #fff; border-color: rgba(155,17,30,.35); color: #7c0c16; }
    button:disabled { opacity: .55; cursor: not-allowed; }

    .hint { font-size: 12px; color: var(--muted); margin-top: 8px; line-height: 1.35; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; padding: 2px 6px; border: 1px solid var(--border); border-radius: 8px; background: #fafafa; }

    /* Para 2 sub-block label */
    .subhdr{
      margin: 14px 0 6px;
      padding: 8px 10px;
      border: 1px solid rgba(0,0,0,.10);
      border-radius: 10px;
      background: #fbfbfb;
      font-size: 12.5px;
      font-weight: 700;
      color: rgba(0,0,0,.78);
    }

    /* ============================================================
       SECTION: GUIDANCE + EXAMPLE TEXT BLOCKS
       ============================================================ */
    .guidance {
      font-style: italic;
      color: var(--guidance);
      font-size: 12.5px;
      line-height: 1.35;
      margin: 6px 0 8px;
    }
    .context {
      font-size: 12.5px;
      line-height: 1.35;
      color: rgba(0,0,0,.78);
      margin: 6px 0 10px;
    }

    /* ============================================================
       SECTION: MODE BANNER (DRAFT vs GENERATED)
       ============================================================ */
    .modebar {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
      padding: 10px 12px;
      border: 1px dashed rgba(0,0,0,.18);
      border-radius: 12px;
      background: #fbfbfb;
      margin-bottom: 10px;
      font-size: 12.5px;
      color: rgba(0,0,0,.75);
      line-height: 1.35;
    }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #fff;
      font-size: 12px;
    }

    /* ============================================================
       SECTION: PREVIEW "PAPER" (8.5 x 11 with 1" margins feel)
       ============================================================ */
    .preview { font-family: "Times New Roman", Times, serif; }
    .paper {
      width: min(100%, var(--page-w));
      margin: 0 auto;
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
    }
    .paper-inner{
      padding: var(--margin);
    }

    /* Preview headers */
    .topline { text-align: center; font-weight: 700; }
    .subline { text-align: center; margin-top: 2px; }
    .meta { display:flex; justify-content: space-between; margin: 10px 0 14px; font-size: 12px; }
    .sect { margin: 12px 0; max-width: var(--usable-w); }
    .sect h3 { margin: 0 0 6px; font-size: 14px; }
    .sect p  { margin: 0 0 8px; font-size: 13px; line-height: 1.35; }
    .mini { font-size: 12px; margin-top: 6px; }
    .muted { color: rgba(0,0,0,.65); }

    /* Para 2 sublabels in preview (used in DRAFT guidance only) */
    .p2-subtitle{
      margin: 8px 0 6px;
      font-size: 13px;
      font-weight: 700;
    }

    /* ============================================================
       SECTION: PARA 2 FIGURE (UPLOAD + PREVIEW + INSERTION)
       ============================================================ */
    .figure-box{
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
      background: #fafafa;
      margin: 10px 0 0;
    }
    .figure-cap{
      font-size: 12px;
      color: rgba(0,0,0,.75);
      margin-top: 6px;
      line-height: 1.25;
    }
    .figure-img{
      width: 100%;
      max-width: var(--usable-w);
      display: block;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: #fff;
    }

    /* ============================================================
       SECTION: RISK MATRIX (AFTER PARA 5)
       ============================================================ */
    .risk-wrap{
      margin-top: 10px;
      max-width: var(--usable-w);
    }
    .risk-title{
      font-size: 12.5px;
      margin: 6px 0 8px;
      line-height: 1.25;
    }
    .risk-center{
      display:flex;
      justify-content:center;
    }
    .risk-cube{
      width: var(--risk-w);
      border: 1px solid var(--gridline);
      border-radius: 10px;
      overflow: hidden;
      background: #fff;
    }
    .risk-grid{
      display:grid;
      grid-template-columns: 44px repeat(5, 1fr);
      grid-template-rows: 34px repeat(5, 1fr);
    }
    .risk-cell{
      border-right: 1px solid var(--gridline);
      border-bottom: 1px solid var(--gridline);
      padding: 6px 6px;
      font-size: 10.5px;
      line-height: 1.15;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      background:#fff;
      min-height: 34px;
    }
    .risk-cell.head{
      font-size: 10px;
      color: rgba(0,0,0,.75);
      background: #f7f7f7;
      font-weight: 600;
    }
    .risk-cell.axis{
      background: #f7f7f7;
      font-weight: 600;
      color: rgba(0,0,0,.75);
    }

    /* Selected cell highlight only */
    .risk-selected.low   { background: rgba(47,122,62,.18); outline: 2px solid rgba(47,122,62,.6); }
    .risk-selected.med   { background: rgba(199,145,0,.20); outline: 2px solid rgba(199,145,0,.65); }
    .risk-selected.high  { background: rgba(162,23,36,.16); outline: 2px solid rgba(162,23,36,.65); }
    .risk-selected .tag  { font-weight: 700; }

    /* ============================================================
       SECTION: VALIDATION / INDICATORS (TENSE + FORMAT)
       ============================================================ */
    .checks{
      margin-top: 10px;
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #fafafa;
      font-size: 12px;
      line-height: 1.35;
      color: rgba(0,0,0,.75);
    }
    .checkline{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding: 4px 0;
      border-bottom: 1px solid rgba(0,0,0,.06);
    }
    .checkline:last-child{ border-bottom: none; }
    .status{
      font-weight: 700;
      white-space: nowrap;
    }
    .ok{ color: #147a2d; }
    .warn{ color: #b17400; }
    .bad{ color: #b00020; }

    /* ============================================================
       SECTION: PRINT (DEMO)
       ============================================================ */
    @media print {
      header, .left, .btnbar { display: none !important; }
      .wrap { padding: 0; }
      .card { border: none; }
      .paper{ border:none; border-radius:0; }
      body { margin: 0; }
    }
  </style>
</head>

<body>
  <!-- ============================================================
       SECTION: HEADER (ORIGINAL LOCATION OF "BACK TO FLOW DIAGRAMS")
       ============================================================ -->
  <header>
    <div class="header-row">
      <div class="header-left">
        <h1>Blue Sheet Builder (Demo)</h1>
        <p>
          Guidance is shown first (pink italics) and remains visible while you type.
          Select <span class="kbd">Generate Preview</span> to replace guidance with your entered content.
        </p>
      </div>
      <div class="header-right">
        <button id="btnBackToFlowTop" class="btn-link" type="button">Back to Flow Diagrams</button>
      </div>
    </div>
  </header>

  <div class="wrap">
    <div class="grid">

      <!-- ============================================================
           SECTION: LEFT PANEL (INPUTS)
           ============================================================ -->
      <div class="card left">
        <h2>Inputs</h2>

        <!-- ---------- Subsection: Demo selection ---------- -->
        <div class="hr"></div>
        <div>
          <label for="sampleSelect">Demo selection</label>
          <select id="sampleSelect">
            <option value="mfd" selected>MFD Example (Office Copier / Printer / Scanner)</option>
            <option value="lcac">LCAC Example (Alternate Template Sample)</option>
            <option value="custom">Custom (manual entry)</option>
          </select>
          <div class="hint">
            Demo mode: selects which guidance + example text is displayed. Inputs remain empty until you enter data.
          </div>
        </div>

        <!-- ---------- Subsection: TEIN / meta ---------- -->
        <div class="hr"></div>
        <div class="row">
          <div>
            <label for="tein">TEIN</label>
            <input id="tein" placeholder="TEIN-DEMO" />
          </div>
          <div>
            <label for="issueNo">Issue #</label>
            <input id="issueNo" placeholder="001" />
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <div>
            <label for="rev">Revision</label>
            <input id="rev" placeholder="0" />
          </div>
          <div>
            <label for="date">Date (DD Mmm YYYY)</label>
            <input id="date" placeholder="27 Dec 2025" />
          </div>
        </div>

        <div class="hr"></div>
        <div>
          <label for="sutName">SUT name</label>
          <input id="sutName" placeholder="Network Multifunction Device (MFD)" />
        </div>

        <!-- ---------- Subsection: Paragraph inputs (EMPTY by requirement) ---------- -->
        <div class="hr"></div>

        <div class="hint">
          Inputs for Paragraphs 1–5 are intentionally blank for the demo. Guidance and example text remain on the right until you generate.
        </div>

        <div style="margin-top:10px;">
          <label for="p1Problem">1. Problem / Issue (past tense, one sentence)</label>
          <textarea id="p1Problem" spellcheck="true" placeholder=""></textarea>
        </div>

        <div class="row3" style="margin-top:10px;">
          <div>
            <label for="riskC">Consequence (1–5)</label>
            <select id="riskC">
              <option value="1">1</option><option value="2">2</option>
              <option value="3" selected>3</option><option value="4">4</option>
              <option value="5">5</option>
            </select>
          </div>
          <div>
            <label for="riskL">Likelihood (1–5)</label>
            <select id="riskL">
              <option value="1">1</option><option value="2">2</option>
              <option value="3" selected>3</option><option value="4">4</option>
              <option value="5">5</option>
            </select>
          </div>
          <div>
            <label for="pmMit">PM mitigation (H/M/L)</label>
            <select id="pmMit">
              <option value="High">High</option>
              <option value="Moderate" selected>Moderate</option>
              <option value="Low">Low</option>
            </select>
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <div>
            <label for="coiPrimary">Primary COI</label>
            <input id="coiPrimary" placeholder="S-7, Training / Supportability" />
          </div>
          <div>
            <label for="coiOther">Other COI(s)</label>
            <input id="coiOther" placeholder="C-3, Network Integration" />
          </div>
        </div>

        <div class="hr"></div>

        <!-- ============================================================
             PARA 2 SPLIT: 2a / 2b / 2c
             ============================================================ -->
        <div class="subhdr">Paragraph 2 (Split): 2a / 2b / 2c</div>

        <div>
          <label for="p2a">2a. Establish the Test Conditions (past tense)</label>
          <textarea id="p2a" spellcheck="true" placeholder=""></textarea>
          <div class="hint">
            1–2 sentences. Frame what testing/vignette/task/subtask was being conducted when the issue was discovered.
          </div>
        </div>

        <div style="margin-top:10px;">
          <label for="p2b">2b. Present Data (past tense)</label>
          <textarea id="p2b" spellcheck="true" placeholder=""></textarea>
          <div class="hint">
            Standalone evidence. Include results (quant/qual), and any operator workaround (objective, third-person).
          </div>
        </div>

        <div style="margin-top:10px;">
          <label for="p2c">2c. Analyze/Evaluate the Data (past tense)</label>
          <textarea id="p2c" spellcheck="true" placeholder=""></textarea>
          <div class="hint">
            What the data indicate and the operational impact. Include before/after workaround effects if applicable.
          </div>
        </div>

        <!-- ---------- Para 2 Figure Upload ---------- -->
        <div style="margin-top:10px;">
          <label for="p2Figure">Paragraph 2 Figure (optional upload)</label>
          <input id="p2Figure" type="file" accept="image/*" />
          <div class="hint">
            Upload an image to demonstrate insertion into Paragraph 2. If present, it becomes <span class="kbd">Figure 1</span>.
            The risk matrix becomes <span class="kbd">Figure 2</span>.
          </div>
        </div>

        <div class="hr"></div>

        <div>
          <label for="p3">3. Mission Relation (future tense, 1–2 sentences)</label>
          <textarea id="p3" spellcheck="true" placeholder=""></textarea>
        </div>

        <div style="margin-top:10px;">
          <label for="p4">4. Mitigation Assessment (present tense)</label>
          <textarea id="p4" spellcheck="true" placeholder=""></textarea>
        </div>

        <div style="margin-top:10px;">
          <label for="p5">5. Conclusion (present tense; up to 3 sentences preferred)</label>
          <textarea id="p5" spellcheck="true" placeholder=""></textarea>
        </div>

        <div class="row" style="margin-top:10px;">
          <div>
            <label for="recommendation">6. Recommendation</label>
            <select id="recommendation">
              <option>Correct prior to IOT&amp;E.</option>
              <option selected>Correct as soon as possible.</option>
              <option>Correct to achieve full mission capability.</option>
            </select>
          </div>
          <div>
            <label for="sheetType">Sheet type</label>
            <select id="sheetType">
              <option selected>Blue Sheet</option>
              <option>Gold Sheet (Demo label only)</option>
            </select>
          </div>
        </div>

        <!-- ---------- Controls ---------- -->
        <div class="btnbar">
          <button class="primary" id="btnGenerate" type="button">Generate Preview</button>
          <button id="btnReset" type="button">Reset</button>
          <button id="btnSave" type="button">Save to DOCX</button>
        </div>

        <div class="hint">
          Demo logic: typing does not modify the preview text. Only <span class="kbd">Generate Preview</span> replaces guidance with inputs.
        </div>

        <!-- ---------- Advisory checks (tenses / formatting) ---------- -->
        <div class="checks" id="checksPanel" aria-label="Tense and format checks">
          <div style="font-weight:700; margin-bottom:6px;">Advisory Checks (Demo)</div>
          <div class="checkline"><span>Paragraph 1: past tense + one sentence + ends with period</span><span id="chkP1" class="status warn">CHECK</span></div>

          <div class="checkline"><span>Paragraph 2a: past tense (advisory)</span><span id="chkP2a" class="status warn">CHECK</span></div>
          <div class="checkline"><span>Paragraph 2b: past tense (advisory)</span><span id="chkP2b" class="status warn">CHECK</span></div>
          <div class="checkline"><span>Paragraph 2c: past tense (advisory)</span><span id="chkP2c" class="status warn">CHECK</span></div>

          <div class="checkline"><span>Paragraph 3: future tense (use “will”)</span><span id="chkP3" class="status warn">CHECK</span></div>
          <div class="checkline"><span>Paragraph 4: present tense (use “is/are”)</span><span id="chkP4" class="status warn">CHECK</span></div>
          <div class="checkline"><span>Paragraph 5: present tense (advisory)</span><span id="chkP5" class="status warn">CHECK</span></div>
        </div>
      </div>

      <!-- ============================================================
           SECTION: RIGHT PANEL (PREVIEW)
           ============================================================ -->
      <div class="card preview">
        <div class="modebar" id="modebar">
          <div>
            <span class="badge" id="modeBadge">DRAFT (Guidance Visible)</span>
            <span style="margin-left:8px;" id="figureNote" class="muted"></span>
          </div>
          <div class="muted">
            Risk Matrix appears after Paragraph 5.
          </div>
        </div>

        <div class="paper" id="paper">
          <div class="paper-inner" id="previewHost"></div>
        </div>

        <div class="hint muted" style="margin-top:10px;">
          Note: For the demo, “Save to DOCX” exports Word-compatible HTML. The full build can generate true DOCX from an official template.
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================================
       SECTION: SCRIPT (ALL LOGIC - LABELED)
       ============================================================ -->
  <script>
  (function () {
    /* ============================================================
       SUBSECTION: DOM HELPERS
       ============================================================ */
    const $ = (id) => document.getElementById(id);

    /* ============================================================
       SUBSECTION: STATE
       ============================================================ */
    let generatedMode = false;

    /* ============================================================
       SUBSECTION: RISK MATRIX LOGIC (DEMO SCALE)
       ============================================================ */
    function riskBandFromCL(c, l) {
      const v = c * l;
      if (v <= 6) return "Low";
      if (v <= 14) return "Medium";
      return "High";
    }

    function riskClassFromBand(band) {
      if (band === "Low") return "low";
      if (band === "Medium") return "med";
      return "high";
    }

    function pmMitLetter(pm) {
      const x = (pm || "").toLowerCase();
      if (x.startsWith("h")) return "H";
      if (x.startsWith("l")) return "L";
      return "M";
    }

    /* ============================================================
       SUBSECTION: DEMO GUIDANCE + EXAMPLE TEXT (MFD / LCAC)
       - Para 2 split into p2a/p2b/p2c
       ============================================================ */
    const GUIDANCE = {
      mfd: {
        sutName: "Network Multifunction Device (MFD) — Office Copier/Printer/Scanner (Network + USB)",

        p1: {
          g:
`Paragraph 1, Problem or Issue Description (past tense).
State the issue. Describe the problem/issue concisely in one sentence using past tense.
Only address one issue/problem per Blue/Gold Sheet.
Do not address/include the operational impact in paragraph 1; the operational impact is discussed in paragraph 2 of the Blue/Gold Sheet.
Be consistent: the same problem statement context/meaning must appear in Paragraph 3 (Mission Relation) and Paragraph 5 (Conclusion).`,
          x:
"The Network Multifunction Device (MFD) experienced intermittent failures to complete Scan-to-Network jobs to approved network destinations during operational use."
        },

        p2a: {
          g:
`2a — Part 1 — Establish the Test Conditions (past tense):
Establish the test conditions in one or two sentences and focus on what testing was being conducted when the problem was discovered.
Describe what vignette, mission, or task/subtask was being performed.
Use the test plan to frame what was being accomplished.
State what was being evaluated and how the evaluation was performed, as well as any pertinent conditions that bound the problem and support repeatability.
The “what” is closely related to the deficiency stated in paragraph 1.`,
          x:
"The MFD’s ability to print from a networked workstation, scan to approved network destinations, scan to a directly connected workstation, and perform copy operations was assessed during routine office operations over a five-day period using standard user accounts, approved network shares, and mixed document types."
        },

        p2b: {
          g:
`2b — Part 2 — Present Data (past tense):
Present only data related to the issue. The sheet must stand alone; do not reference the data analysis summary memorandum.
Pull the specific data/results needed to make the case to the reader.
Photos, screen shots, figures, and tables with detailed annotation are encouraged.
When annotating figures/photos/screenshots, use the same wording as in paragraph 2 text to help the reader follow.
State what data were collected; include quantitative and/or qualitative results.
Include a description of any work-around (using the SUT) if used by operators to overcome the issue.
Present the data from a third-person, objective point of view; focus on results, not test method.`,
          x:
"Scan-to-Network failures occurred in 9 of 50 scan attempts and resulted in job termination with an on-panel error message and no file written to the destination share. In 6 of the 9 failed attempts, users repeated the scan job without modifying settings and achieved successful completion on a subsequent attempt. As a workaround, users performed Scan-to-PC via USB connection and manually transferred files to the network, increasing task steps and time to completion."
        },

        p2c: {
          g:
`2c — Part 3 — Analyze/Evaluate the Data (past tense):
Analyze/evaluate the data. Use the data and results presented to explain the impact upon the operator, mission, or task/subtask.
What does the data indicate?
Evaluation may include comparison to legacy systems.
Evaluate how any work-around mitigates the issue and the resulting impact on mission accomplishment both before and after the work-around.`,
          x:
"The data indicated that the MFD’s Scan-to-Network function reliability was inconsistent under normal operational loads. While a workaround existed, the workaround increased user workload, introduced additional opportunities for error, and reduced confidence that scanned products were reliably captured and distributed."
        },

        p3: {
          g:
`Paragraph 3, Mission Relation (future tense).
This is the “so what.”
Paragraph 3 must build upon the data, results, analysis, and evaluation presented in paragraph 2.
Describe the impact to the Fleet, operator, or mission of the problem described in paragraph 1.
Ensure the problem is included in the mission relation and stated in the same context/meaning as paragraph 1.
Present the mission relation paragraph in future tense.
Mission relation should normally be no more than one sentence, and rarely over two sentences.
A boilerplate for mission relation is typically provided in report templates and its use is strongly encouraged.`,
          x:
"During routine administrative document processing, intermittent Scan-to-Network failures will delay dissemination of scanned products and increase the likelihood of incomplete or misrouted documentation, resulting in degraded office workflow and delayed completion of time-sensitive administrative actions."
        },

        p4: {
          g:
`Paragraph 4, Mitigation Assessment (present tense).
Describe mitigation actions, their status, and the assessed likelihood the issue will be corrected or sufficiently mitigated prior to the next relevant test window.
Focus on current mitigations, planned mitigations, and the realistic schedule/constraints that affect whether mitigation will be in place when needed.`,
          x:
"Based on coordination with the system administrator and vendor support, the technical solution is being investigated and is believed to involve network authentication handling and destination share configuration during Scan-to-Network operations. Proposed mitigation actions include firmware updates, standardized destination configurations, and service account policy alignment. Limited time is available prior to the next operational demonstration to fully validate a permanent fix. It is assessed there is a moderate possibility Scan-to-Network reliability will not be fully corrected prior to the next test event."
        },

        p5: {
          g:
`Paragraph 5, Conclusion (present tense).
The conclusion is typically one simple sentence where the subject is the problem and the predicate is the level of the risk or deficiency (Severe, Major 1, 2, 3, or Minor).
Ensure the problem is restated in the same context as in paragraph 1 (and consistent with paragraph 3).
For revised sheets where the level has been mitigated/elevated, state the updated deficiency level.
For issues verified corrected, state the issue was corrected and the risk/deficiency is closed.
For issues administratively closed, state the issue is administratively closed.`,
          x:
"The MFD’s intermittent failures to complete Scan-to-Network jobs are of moderate consequence and moderate likelihood to occur. Additionally, there is a moderate possibility the failures will not be corrected or substantially mitigated prior to the next operational demonstration event. If this risk is unmitigated, it will potentially be a Major 3 deficiency."
        }
      },

      lcac: {
        sutName: "Landing Craft Air Cushion (LCAC) — Demonstration Alternate Example",

        p1: {
          g:
`Paragraph 1, Problem or Issue Description (past tense).
State the issue in one sentence using past tense.
Only address one issue/problem per sheet.
Do not include operational impact in paragraph 1; impact belongs in paragraph 2.
Be consistent across Paragraph 1, Paragraph 3, and Paragraph 5 when describing the problem.`,
          x:
"The LCAC experienced intermittent loss of navigation display updates during high-vibration operations."
        },

        p2a: {
          g:
`2a — Part 1 — Establish the Test Conditions (past tense):
Describe what mission/task/subtask was being performed and what conditions bound the problem for repeatability.`,
          x:
"The LCAC’s navigation subsystem was assessed during a mission profile including transit, approach, and beaching evolutions in Sea State 3 conditions."
        },

        p2b: {
          g:
`2b — Part 2 — Present Data (past tense):
Present only data related to the issue. The sheet stands alone; do not reference other memoranda.
Include qualitative/quantitative results and any operator workaround.`,
          x:
"During multiple high-vibration segments, the navigation display intermittently stopped updating position and heading data while other bridge systems remained operational. Navigation display update loss occurred in 3 of 12 high-vibration segments and required the operator to cycle display power to restore updates. As a workaround, the crew relied on alternate instruments and verbal cross-checks, increasing workload and slowing maneuver decision-making."
        },

        p2c: {
          g:
`2c — Part 3 — Analyze/Evaluate the Data (past tense):
Explain what the data indicate and how it impacts the operator/mission.
Evaluate effectiveness and mission impact of any workaround both before/after application.`,
          x:
"The data indicated the navigation display update reliability was inconsistent under expected environmental conditions and increased reliance on procedural mitigations, which elevated crew workload and reduced margin for error during maneuvering."
        },

        p3: {
          g:
`Paragraph 3, Mission Relation (future tense).
Build directly on paragraph 2 results/analysis.
Include the problem in the same context/meaning as paragraph 1.
Use future tense; normally 1–2 sentences.`,
          x:
"During high-demand maneuvering, intermittent loss of navigation display updates will increase crew workload and delay corrective action, resulting in degraded navigation safety and reduced confidence in maneuver execution."
        },

        p4: {
          g:
`Paragraph 4, Mitigation Assessment (present tense).
Describe what mitigation is being done now, what is planned, and the realistic likelihood it will be corrected or mitigated prior to the next relevant test window.`,
          x:
"The vendor and maintenance activity are evaluating display update loss conditions and potential wiring and mounting improvements. Interim mitigations include procedural cross-checks and pre-mission verification of connectors. It is assessed there is a moderate possibility the display update loss will not be fully corrected prior to the next operational event."
        },

        p5: {
          g:
`Paragraph 5, Conclusion (present tense).
Restate the problem consistently with paragraph 1 and 3.
State the level of risk/deficiency or closure status (corrected/closed/administratively closed).`,
          x:
"The LCAC’s intermittent loss of navigation display updates is of moderate consequence and low to moderate likelihood to occur. Additionally, there is a moderate possibility the issue will not be corrected prior to the next operational event. If unmitigated, the risk will potentially be categorized as a Major 3 deficiency."
        }
      }
    };

    /* ============================================================
       SUBSECTION: FORM FIELD LIST (ALL INPUTS)
       ============================================================ */
    const fields = [
      "tein","issueNo","rev","date","sutName",
      "p1Problem","riskC","riskL","pmMit",
      "coiPrimary","coiOther",
      "p2a","p2b","p2c",
      "p3","p4","p5",
      "recommendation","sheetType"
    ];

    function getForm() {
      const d = {};
      fields.forEach(k => d[k] = ($(k)?.value || "").trim());
      return d;
    }

    /* ============================================================
       SUBSECTION: SAFE HTML ESCAPE + PARAGRAPH FORMATTER
       ============================================================ */
    function esc(s) {
      return (s || "")
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;");
    }

    function para(text) {
      const parts = (text || "").split(/\n\s*\n/).map(t => t.trim()).filter(Boolean);
      return parts.map(p => `<p>${esc(p)}</p>`).join("");
    }

    /* ============================================================
       SUBSECTION: FIGURE UPLOAD (PARA 2)
       ============================================================ */
    let p2FigureDataUrl = null;
    let p2FigureName = null;

    async function fileToDataUrl(file) {
      return new Promise((resolve, reject) => {
        const r = new FileReader();
        r.onload = () => resolve(String(r.result || ""));
        r.onerror = reject;
        r.readAsDataURL(file);
      });
    }

    async function onFigureChange() {
      const input = $("p2Figure");
      const file = input && input.files ? input.files[0] : null;
      if (!file) {
        p2FigureDataUrl = null;
        p2FigureName = null;
        renderPreview();
        return;
      }
      p2FigureName = file.name || "figure";
      p2FigureDataUrl = await fileToDataUrl(file);
      renderPreview();
    }

    /* ============================================================
       SUBSECTION: RISK MATRIX RENDERER (Figure X)
       ============================================================ */
    function renderRiskMatrix(d, figureNumber) {
      const c = parseInt(d.riskC || "3", 10);
      const l = parseInt(d.riskL || "3", 10);
      const band = riskBandFromCL(c, l);
      const cls  = riskClassFromBand(band);
      const teinTag = `${esc(d.tein || "TEIN")}-${pmMitLetter(d.pmMit)}`;

      const title = `Figure ${figureNumber}. ${band} Risk (Selected: C${c} x L${l})`;

      let html = `
        <div class="risk-wrap">
          <div class="risk-title"><strong>${esc(title)}</strong></div>
          <div class="risk-center">
            <div class="risk-cube" role="img" aria-label="Risk matrix">
              <div class="risk-grid">
      `;

      html += `<div class="risk-cell head"></div>`;
      for (let cx = 1; cx <= 5; cx++) html += `<div class="risk-cell head">C${cx}</div>`;

      for (let ly = 5; ly >= 1; ly--) {
        html += `<div class="risk-cell axis">L${ly}</div>`;
        for (let cx = 1; cx <= 5; cx++) {
          const isSelected = (cx === c && ly === l);
          const selectedClass = isSelected ? `risk-selected ${cls}` : "";
          const cellText = isSelected ? `<span class="tag">${teinTag}</span>` : "";
          html += `<div class="risk-cell ${selectedClass}">${cellText}</div>`;
        }
      }

      html += `
              </div>
            </div>
          </div>
        </div>
      `;
      return html;
    }

    /* ============================================================
       SUBSECTION: DRAFT GUIDANCE RENDERERS (guidance + example)
       ============================================================ */
    function guidanceBlock(g, x) {
      return `
        <div class="guidance">${esc(g)}</div>
        <div class="context">${para(x)}</div>
      `;
    }

    /* ============================================================
       SUBSECTION: PARA 2 ASSEMBLY (GENERATED MODE)
       - Draft shows guidance separately; Generated stitches 2a/2b/2c
       - COMPLIANCE: Generated output MUST NOT show 2a/2b/2c labels.
       ============================================================ */
    function renderPara2Generated(d, hasP2Figure, p2FigureHtml) {
      const a = (d.p2a || "").trim();
      const b = (d.p2b || "").trim();
      const c = (d.p2c || "").trim();

      // One Paragraph 2 body, assembled in order (2a -> 2b -> 2c), no visible sublabels.
      const combined = [a, b, c].filter(Boolean).join("\n\n");
      const bodyHtml = combined ? para(combined) : `<p class="muted">[Paragraph 2 not entered]</p>`;

      return `
        ${bodyHtml}
        ${p2FigureHtml || ""}
      `;
    }

    function renderPara2Draft(gset, hasP2Figure, p2FigureHtml) {
      return `
        <div class="p2-subtitle">2a. Establish the Test Conditions.</div>
        ${guidanceBlock(gset.p2a.g, gset.p2a.x)}

        <div class="p2-subtitle">2b. Present Data.</div>
        ${guidanceBlock(gset.p2b.g, gset.p2b.x)}
        ${p2FigureHtml}

        <div class="p2-subtitle">2c. Analyze/Evaluate the Data.</div>
        ${guidanceBlock(gset.p2c.g, gset.p2c.x)}
      `;
    }

    /* ============================================================
       SUBSECTION: PREVIEW RENDERER (PAPER CONTENT)
       ============================================================ */
    function renderPreviewHtml() {
      const d = getForm();

      const pendingRiskNo = `${esc(d.tein || "TEIN-DEMO")}-${esc(d.issueNo || "001")} (Rev ${esc(d.rev || "0")})`;

      const hasP2Figure = !!p2FigureDataUrl;
      const riskFigureNumber = hasP2Figure ? 2 : 1;

      const riskTag = `((${esc(d.riskC || "3")}x${esc(d.riskL || "3")}) ${esc(d.pmMit || "Moderate")})`;

      const demoKey = ($("sampleSelect")?.value || "mfd");
      const gset = GUIDANCE[demoKey] || GUIDANCE.mfd;

      const sutLine = generatedMode
        ? esc(d.sutName || gset.sutName)
        : esc(gset.sutName);

      const p1Body = generatedMode
        ? (d.p1Problem ? `<p>${esc(d.p1Problem)} ${riskTag}</p>` : `<p class="muted">[Paragraph 1 not entered]</p>`)
        : (guidanceBlock(gset.p1.g, `${gset.p1.x} ${riskTag}`));

      let p2FigureHtml = "";
      if (hasP2Figure) {
        p2FigureHtml = `
          <div class="figure-box">
            <img class="figure-img" src="${p2FigureDataUrl}" alt="Uploaded figure for Paragraph 2" />
            <div class="figure-cap"><strong>Figure 1.</strong> ${esc(p2FigureName || "Uploaded figure")}</div>
          </div>
        `;
      } else if (!generatedMode) {
        p2FigureHtml = `
          <div class="figure-box">
            <div class="muted" style="font-size:12px;">
              <strong>[Sample Figure Location]</strong> If a figure is uploaded for Paragraph 2, it will appear here as <strong>Figure 1</strong>.
              The risk matrix will then be labeled <strong>Figure 2</strong>.
            </div>
          </div>
        `;
      }

      const p2Body = generatedMode
        ? renderPara2Generated(d, hasP2Figure, p2FigureHtml)
        : renderPara2Draft(gset, hasP2Figure, p2FigureHtml);

      const p3Body = generatedMode
        ? (d.p3 ? para(d.p3) : `<p class="muted">[Paragraph 3 not entered]</p>`)
        : guidanceBlock(gset.p3.g, gset.p3.x);

      const p4Body = generatedMode
        ? (d.p4 ? para(d.p4) : `<p class="muted">[Paragraph 4 not entered]</p>`)
        : guidanceBlock(gset.p4.g, gset.p4.x);

      const p5Body = generatedMode
        ? (d.p5 ? para(d.p5) : `<p class="muted">[Paragraph 5 not entered]</p>`)
        : guidanceBlock(gset.p5.g, gset.p5.x);

      const riskMatrix = renderRiskMatrix(d, riskFigureNumber);
      const p6Body = `<p>${esc(d.recommendation || "Correct as soon as possible.")}</p>`;

      const dateLine = esc(d.date || "DD Mmm YYYY");
      const coiPrimary = esc(d.coiPrimary || "");
      const coiOther = esc(d.coiOther || "");

      return `
        <div class="topline">DRAFT</div>
        <div class="subline"><strong>COMMANDER, OPERATIONAL TEST AND EVALUATION FORCE</strong></div>
        <div class="subline"><strong>PENDING RISK NO.</strong> ${pendingRiskNo}</div>
        <div class="subline"><strong>${esc(d.sheetType || "Blue Sheet")}</strong></div>

        <div class="meta">
          <div><span class="muted">Date:</span> ${dateLine}</div>
          <div><span class="muted">SUT:</span> ${sutLine}</div>
        </div>

        <div class="sect">
          <h3>1. SYSTEM UNDER TEST PENDING RISK.</h3>
          ${p1Body}
          <div class="mini">
            <div><span class="muted">a. Primary COI:</span> ${coiPrimary}</div>
            <div><span class="muted">b. Other COI(s):</span> ${coiOther}</div>
            <div><span class="muted">c. Previously Identified:</span> No.</div>
          </div>
        </div>

        <div class="sect">
          <!-- COMPLIANCE: No "(*)" here -->
          <h3>2. TEST CONDITIONS, RESULTS, AND ANALYSIS.</h3>
          ${p2Body}
        </div>

        <div class="sect">
          <h3>3. MISSION RELATION.</h3>
          ${p3Body}
        </div>

        <div class="sect">
          <h3>4. MITIGATION ASSESSMENT FOR INITIAL OPERATIONAL TEST AND EVALUATION (IOT&amp;E).</h3>
          ${p4Body}
        </div>

        <div class="sect">
          <h3>5. CONCLUSION.</h3>
          ${p5Body}
          ${riskMatrix}
        </div>

        <div class="sect">
          <h3>6. RECOMMENDATION.</h3>
          ${p6Body}
        </div>
      `;
    }

    /* ============================================================
       SUBSECTION: RENDER + MODE MANAGEMENT
       ============================================================ */
    function setMode(isGenerated) {
      generatedMode = !!isGenerated;

      const badge = $("modeBadge");
      const note = $("figureNote");

      if (generatedMode) {
        if (badge) badge.textContent = "GENERATED (Guidance Hidden)";
      } else {
        if (badge) badge.textContent = "DRAFT (Guidance Visible)";
      }

      const hasP2Figure = !!p2FigureDataUrl;
      const riskFig = hasP2Figure ? 2 : 1;
      if (note) {
        note.textContent = hasP2Figure
          ? `Para 2 includes Figure 1. Risk Matrix is Figure ${riskFig}.`
          : `No Para 2 figure. Risk Matrix is Figure ${riskFig}.`;
      }
    }

    function renderPreview() {
      const host = $("previewHost");
      if (!host) return;
      host.innerHTML = renderPreviewHtml();
      runAdvisoryChecks();
    }

    /* ============================================================
       SUBSECTION: ADVISORY CHECKS (TENSE/FORMAT)
       ============================================================ */
    function setCheck(id, level, label) {
      const el = $(id);
      if (!el) return;
      el.classList.remove("ok","warn","bad");
      el.classList.add(level);
      el.textContent = label;
    }

    function isOneSentence(s) {
      const t = (s || "").trim();
      if (!t) return false;
      const matches = t.match(/[.!?]/g) || [];
      return matches.length === 1;
    }

    function looksPastTense(s) {
      const t = (s || "").toLowerCase();
      if (!t) return false;
      return /(\bwas\b|\bwere\b|\bexperienced\b|\bfailure\b|\bfailed\b|\boccurred\b|\bresulted\b|\bterminated\b|\bassessed\b|\bobserved\b|\brequired\b|\bincreased\b)/.test(t)
        || /\b\w+ed\b/.test(t);
    }

    function looksFutureTense(s) {
      const t = (s || "").toLowerCase();
      if (!t) return false;
      return /\bwill\b/.test(t);
    }

    function looksPresentTense(s) {
      const t = (s || "").toLowerCase();
      if (!t) return false;
      return /(\bis\b|\bare\b|\bhas\b|\bhave\b|\bassess\b|\bbelieve\b|\binclude\b|\bindicate\b)/.test(t);
    }

    function runAdvisoryChecks() {
      const d = getForm();

      // P1
      const p1 = d.p1Problem;
      if (!p1) {
        setCheck("chkP1","warn","EMPTY");
      } else {
        const endsPeriod = p1.trim().endsWith(".");
        const oneSentence = isOneSentence(p1);
        const past = looksPastTense(p1);
        if (endsPeriod && oneSentence && past) setCheck("chkP1","ok","OK");
        else if (past) setCheck("chkP1","warn","REVIEW");
        else setCheck("chkP1","bad","FIX");
      }

      // P2a / P2b / P2c (separate advisory)
      const p2a = d.p2a;
      if (!p2a) setCheck("chkP2a","warn","EMPTY");
      else if (looksPastTense(p2a)) setCheck("chkP2a","ok","OK");
      else setCheck("chkP2a","warn","REVIEW");

      const p2b = d.p2b;
      if (!p2b) setCheck("chkP2b","warn","EMPTY");
      else if (looksPastTense(p2b)) setCheck("chkP2b","ok","OK");
      else setCheck("chkP2b","warn","REVIEW");

      const p2c = d.p2c;
      if (!p2c) setCheck("chkP2c","warn","EMPTY");
      else if (looksPastTense(p2c)) setCheck("chkP2c","ok","OK");
      else setCheck("chkP2c","warn","REVIEW");

      // P3
      const p3 = d.p3;
      if (!p3) setCheck("chkP3","warn","EMPTY");
      else if (looksFutureTense(p3)) setCheck("chkP3","ok","OK");
      else setCheck("chkP3","bad","ADD “WILL”");

      // P4
      const p4 = d.p4;
      if (!p4) setCheck("chkP4","warn","EMPTY");
      else if (looksPresentTense(p4)) setCheck("chkP4","ok","OK");
      else setCheck("chkP4","warn","REVIEW");

      // P5
      const p5 = d.p5;
      if (!p5) setCheck("chkP5","warn","EMPTY");
      else if (looksPresentTense(p5)) setCheck("chkP5","ok","OK");
      else setCheck("chkP5","warn","REVIEW");
    }

    /* ============================================================
       SUBSECTION: RESET (DEMO BEHAVIOR)
       ============================================================ */
    function resetAll() {
      fields.forEach(k => {
        const el = $(k);
        if (!el) return;
        if (k === "riskC") el.value = "3";
        else if (k === "riskL") el.value = "3";
        else if (k === "pmMit") el.value = "Moderate";
        else if (k === "recommendation") el.value = "Correct as soon as possible.";
        else if (k === "sheetType") el.value = "Blue Sheet";
        else el.value = "";
      });

      const fig = $("p2Figure");
      if (fig) fig.value = "";
      p2FigureDataUrl = null;
      p2FigureName = null;

      setMode(false);
      renderPreview();
    }

    /* ============================================================
       SUBSECTION: SAVE TO DOCX (DEMO)
       ============================================================ */
    function saveToDocxDemo() {
      const previewHtml = $("previewHost") ? $("previewHost").innerHTML : "";

      const doc =
`<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Blue Sheet Export</title>
<style>
  body{ font-family: "Times New Roman", Times, serif; }
  .page{ width: ${esc(getComputedStyle(document.documentElement).getPropertyValue("--page-w").trim() || "8.5in")}; }
  .margins{ padding: ${esc(getComputedStyle(document.documentElement).getPropertyValue("--margin").trim() || "1in")}; }
  .sect{ max-width: ${esc(getComputedStyle(document.documentElement).getPropertyValue("--usable-w").trim() || "6.5in")}; }
</style>
</head>
<body>
  <div class="page">
    <div class="margins">
      ${previewHtml}
    </div>
  </div>
</body>
</html>`;

      const blob = new Blob([doc], { type: "application/msword" });

      const d = getForm();
      const fname = (d.tein || "TEIN") + "-" + (d.issueNo || "000") + "-BlueSheet.doc";
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = fname.replace(/[^\w.\-]+/g, "_");
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        URL.revokeObjectURL(a.href);
        a.remove();
      }, 500);
    }

    /* ============================================================
       SUBSECTION: NAVIGATION (BACK TO FLOW DIAGRAMS)
       ============================================================ */
    function goBackToFlow() {
      window.location.href = "./index.html";
    }

    /* ============================================================
       SUBSECTION: QUERY STRING SUPPORT (?sample=mfd|lcac)
       ============================================================ */
    function applyQueryString() {
      const params = new URLSearchParams(window.location.search);
      const sample = (params.get("sample") || "").toLowerCase();
      if (sample === "mfd" || sample === "lcac") {
        const sel = $("sampleSelect");
        if (sel) sel.value = sample;
      }
    }

    /* ============================================================
       SUBSECTION: EVENT WIRING (LABELED)
       ============================================================ */
    function wireEvents() {
      $("btnBackToFlowTop")?.addEventListener("click", (e) => { e.preventDefault(); goBackToFlow(); });

      $("sampleSelect")?.addEventListener("change", () => {
        setMode(generatedMode);
        renderPreview();
      });

      $("p2Figure")?.addEventListener("change", async () => {
        try { await onFigureChange(); } catch(e) { console.error(e); }
      });

      $("btnGenerate")?.addEventListener("click", (e) => {
        e.preventDefault();
        setMode(true);
        renderPreview();
      });

      $("btnReset")?.addEventListener("click", (e) => {
        e.preventDefault();
        resetAll();
      });

      $("btnSave")?.addEventListener("click", (e) => {
        e.preventDefault();
        saveToDocxDemo();
      });

      // Advisory checks update as user types (checks only)
      ["p1Problem","p2a","p2b","p2c","p3","p4","p5","riskC","riskL","pmMit"].forEach(id => {
        $(id)?.addEventListener("input", runAdvisoryChecks);
        $(id)?.addEventListener("change", () => { runAdvisoryChecks(); renderPreview(); });
      });

      // Meta fields: keep preview headers/risk current
      ["tein","issueNo","rev","date","sutName","coiPrimary","coiOther","recommendation","sheetType"].forEach(id => {
        $(id)?.addEventListener("change", renderPreview);
        $(id)?.addEventListener("input", renderPreview);
      });
    }

    /* ============================================================
       SUBSECTION: INITIALIZE
       ============================================================ */
    function init() {
      applyQueryString();

      setMode(false);

      const demoKey = ($("sampleSelect")?.value || "mfd");
      $("sutName").value = GUIDANCE[demoKey]?.sutName || GUIDANCE.mfd.sutName;

      renderPreview();
      wireEvents();
      runAdvisoryChecks();
    }

    init();
  })();
  </script>
</body>
</html>
