<!-- ============================================================
  File: /docs/tacon-demo.html
  Tactical Consideration Builder (Demo) — Self-Contained
  --------------------------------------------------------------------
  PURPOSE (Demo):
    - Commander-level Tactical Consideration (TACON) template builder.
    - Guidance text is shown first (pink italics + black example context).
    - Preview does NOT change while typing.
    - When user clicks "Generate Preview", guidance disappears and user input replaces it.
    - Save to DOCX exports Word-compatible HTML (.doc) for POC.

  EXAMPLE SYSTEM UNDER TEST (Demo):
    - Office Copier / Printer / Scanner (MFD)
    - SoS 1: Network environment
    - SoS 2: Direct USB-connected workstation
============================================================ -->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TACON Builder (Demo)</title>

  <style>
    :root{
      --border: rgba(0,0,0,.14);
      --muted: rgba(0,0,0,.65);
      --ink: #111;
      --guidance: #FF33CC; /* RGB(255,51,204) */

      /* Print geometry (8.5 x 11 feel) */
      --page-w: 8.5in;
      --page-h: 11in;
      --margin: 1in;
      --usable-w: 6.5in;  /* 8.5 - 2*1 */

      /* UI layout */
      --ui-max: 1180px;

      /* Status colors (Advisory checks) */
      --ok: #2f7a3e;
      --warn: #c79100;
      --bad: #a21724;
    }

    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
      color: var(--ink);
      background: #fff;
    }

    header {
      padding: 16px 18px;
      border-bottom: 1px solid var(--border);
      background: #fff;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .header-row{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:16px;
    }
    .header-left{ flex: 1 1 auto; min-width: 0; }
    .header-right{ flex: 0 0 auto; padding-top: 2px; }

    header h1 { margin: 0 0 6px; font-size: 18px; }
    header p  { margin: 0; color: var(--muted); font-size: 13px; line-height: 1.35; }

    .btn-link{
      border: 1px solid var(--border);
      background: #f7f7f7;
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 13px;
      cursor: pointer;
      white-space: nowrap;
    }

    .wrap { max-width: var(--ui-max); margin: 0 auto; padding: 16px 18px; }
    .grid { display: grid; grid-template-columns: 460px 1fr; gap: 14px; align-items: start; }
    @media (max-width: 1100px) {
      .grid { grid-template-columns: 1fr; }
      header{ position: static; }
    }

    .card { border: 1px solid var(--border); border-radius: 12px; padding: 14px; background: #fff; }
    .card h2 { margin: 0; font-size: 14px; }
    .hr { border-top: 1px solid var(--border); margin: 12px 0; }

    label { display: block; font-size: 12px; color: var(--muted); margin: 0 0 6px; }
    input, select, textarea {
      width: 100%; box-sizing: border-box;
      border: 1px solid var(--border); border-radius: 10px;
      padding: 10px; font-size: 13px; background: #fff;
    }
    textarea { min-height: 86px; resize: vertical; }

    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .btnbar { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }

    button {
      border: 1px solid var(--border);
      background: #f7f7f7; border-radius: 10px;
      padding: 10px 12px; font-size: 13px; cursor: pointer;
    }
    button.primary { background: #111; color: #fff; border-color: #111; }
    button:disabled { opacity: .55; cursor: not-allowed; }

    .hint { font-size: 12px; color: var(--muted); margin-top: 8px; line-height: 1.35; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; padding: 2px 6px; border: 1px solid var(--border); border-radius: 8px; background: #fafafa; }

    .guidance {
      font-style: italic;
      color: var(--guidance);
      font-size: 12.5px;
      line-height: 1.35;
      margin: 6px 0 8px;
    }
    .context {
      font-size: 12.5px;
      line-height: 1.35;
      color: rgba(0,0,0,.78);
      margin: 6px 0 10px;
    }

    .modebar {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
      padding: 10px 12px;
      border: 1px dashed rgba(0,0,0,.18);
      border-radius: 12px;
      background: #fbfbfb;
      margin-bottom: 10px;
      font-size: 12.5px;
      color: rgba(0,0,0,.75);
      line-height: 1.35;
    }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #fff;
      font-size: 12px;
    }

    .preview { font-family: "Times New Roman", Times, serif; }
    .paper {
      width: min(100%, var(--page-w));
      margin: 0 auto;
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
    }
    .paper-inner{ padding: var(--margin); }

    .topline { text-align: center; font-weight: 700; }
    .subline { text-align: center; margin-top: 2px; }
    .meta { display:flex; justify-content: space-between; margin: 10px 0 14px; font-size: 12px; }
    .sect { margin: 12px 0; max-width: var(--usable-w); }
    .sect h3 { margin: 0 0 6px; font-size: 14px; }
    .sect p  { margin: 0 0 8px; font-size: 13px; line-height: 1.35; }

    .muted { color: rgba(0,0,0,.65); }

    .checks{
      margin-top: 10px;
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #fafafa;
      font-size: 12px;
      line-height: 1.35;
      color: rgba(0,0,0,.75);
    }
    .checkline{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding: 4px 0;
      border-bottom: 1px solid rgba(0,0,0,.06);
    }
    .checkline:last-child{ border-bottom: none; }
    .status{ font-weight: 700; white-space: nowrap; }
    .ok{ color: var(--ok); }
    .warn{ color: var(--warn); }
    .bad{ color: var(--bad); }

    @media print {
      header, .left, .btnbar { display: none !important; }
      .wrap { padding: 0; }
      .card { border: none; }
      .paper{ border:none; border-radius:0; }
      body { margin: 0; }
    }
  </style>
</head>

<body>
  <header>
    <div class="header-row">
      <div class="header-left">
        <h1>TACON Builder (Demo)</h1>
        <p>
          Guidance is shown first (pink italics) and remains visible while you type.
          Select <span class="kbd">Generate Preview</span> to replace guidance with your entered content.
        </p>
      </div>
      <div class="header-right">
        <button id="btnBack" class="btn-link" type="button">Back</button>
      </div>
    </div>
  </header>

  <div class="wrap">
    <div class="grid">

      <!-- LEFT: INPUTS -->
      <div class="card left">
        <h2>Inputs</h2>

        <div class="hr"></div>
        <div class="row">
          <div>
            <label for="refId">Reference ID (optional)</label>
            <input id="refId" placeholder="TACON-DEMO-001" />
          </div>
          <div>
            <label for="date">Date (DD Mmm YYYY)</label>
            <input id="date" placeholder="31 Dec 2025" />
          </div>
        </div>

        <div style="margin-top:10px;">
          <label for="sutName">SUT name</label>
          <input id="sutName" placeholder="Office Copier / Printer / Scanner (MFD)" />
          <div class="hint">
            Demo SUT supports SoS 1 (Network) and SoS 2 (USB direct-connected workstation).
          </div>
        </div>

        <div class="hr"></div>

        <div class="hint">
          Inputs are intentionally blank for the demo. Guidance and example text remain on the right until you generate.
        </div>

        <div style="margin-top:10px;">
          <label for="p1">1. Observed Tactical Problem (past tense)</label>
          <textarea id="p1" spellcheck="true" placeholder=""></textarea>
        </div>

        <div style="margin-top:10px;">
          <label for="p2">2. Conditions, Events, and Analysis</label>
          <textarea id="p2" spellcheck="true" placeholder=""></textarea>
        </div>

        <div style="margin-top:10px;">
          <label for="p3">3. Mission Impact (commander/planner perspective)</label>
          <textarea id="p3" spellcheck="true" placeholder=""></textarea>
        </div>

        <div style="margin-top:10px;">
          <label for="p4">4. Tactical Recommendation (employment / management)</label>
          <textarea id="p4" spellcheck="true" placeholder=""></textarea>
        </div>

        <div style="margin-top:10px;">
          <label for="p5">5. Likelihood of Occurrence</label>
          <textarea id="p5" spellcheck="true" placeholder=""></textarea>
        </div>

        <div style="margin-top:10px;">
          <label for="p6">6. Recommendation (TTP / planning integration)</label>
          <textarea id="p6" spellcheck="true" placeholder=""></textarea>
        </div>

        <div class="btnbar">
          <button class="primary" id="btnGenerate" type="button">Generate Preview</button>
          <button id="btnReset" type="button">Reset</button>
          <button id="btnSave" type="button">Save to DOCX</button>
        </div>

        <div class="hint">
          Demo logic: typing does not modify the preview. Only <span class="kbd">Generate Preview</span> replaces guidance with inputs.
        </div>

        <div class="checks" id="checksPanel" aria-label="Advisory checks">
          <div style="font-weight:700; margin-bottom:6px;">Advisory Checks (Demo)</div>
          <div class="checkline"><span>Para 1: past tense</span><span id="chk1" class="status warn">CHECK</span></div>
          <div class="checkline"><span>Para 4: tactical recommendation (mentions planning/employment)</span><span id="chk4" class="status warn">CHECK</span></div>
        </div>
      </div>

      <!-- RIGHT: PREVIEW -->
      <div class="card preview">
        <div class="modebar">
          <div>
            <span class="badge" id="modeBadge">DRAFT (Guidance Visible)</span>
          </div>
          <div class="muted">TACON is commander-level guidance.</div>
        </div>

        <div class="paper">
          <div class="paper-inner" id="previewHost"></div>
        </div>

        <div class="hint muted" style="margin-top:10px;">
          Note: “Save to DOCX” exports Word-compatible HTML (.doc) for demo purposes.
        </div>
      </div>

    </div>
  </div>

  <script>
  (function(){
    /* ---------------- DOM helper ---------------- */
    const $ = (id) => document.getElementById(id);

    /* ---------------- State ---------------- */
    let generatedMode = false;

    /* ---------------- Guidance content (Office MFD demo) ---------------- */
    const GUIDANCE = {
      sutName: "Office Copier / Printer / Scanner (MFD) — SoS 1: Network | SoS 2: USB-connected workstation",
      p1: {
        g:
`Paragraph 1 — Observed Tactical Problem (past tense).
State the observed limitation or performance characteristic with tactical relevance. Frame it for commanders/planners (employment, management, SoS use).`,
        x:
"During high-demand network operations, the MFD exhibited reduced throughput and increased job latency when supporting multiple concurrent network users compared to direct-connected workstation use."
      },
      p2: {
        g:
`Paragraph 2 — Conditions, Events, and Analysis.
Describe operational conditions (workload, concurrency, network constraints), what was observed, and why. Emphasize SoS-level interactions rather than operator keystrokes.`,
        x:
`Operational testing assessed the MFD’s ability to print from networked PCs, scan to approved network destinations, scan to a direct-connected workstation, and copy under routine office demand. The MFD performed reliably for a single workstation via USB connection and for small workgroups on the network.\n\nAs concurrent network demand increased (multiple users printing and scanning to shared destinations), job queuing increased, latency increased, and scan-to-network reliability degraded relative to direct-connected scanning. Analysis indicates the MFD is optimized for small workgroup-scale network services and is more susceptible to contention and policy/authentication overhead when network demand increases.`
      },
      p3: {
        g:
`Paragraph 3 — Mission Impact (commander/planner perspective).
Describe how this affects organizational productivity, information flow, timing, or operational efficiency at the unit level.`,
        x:
"Failure to account for scalability limitations can reduce availability of printing and scanning services, delay distribution of time-sensitive documents, and degrade organizational productivity during high-demand periods."
      },
      p4: {
        g:
`Paragraph 4 — Tactical Recommendation (employment / management).
Provide a recommendation for planners/managers to employ, allocate, or manage the system more effectively (deployment plan, segmentation, prioritization, redundancy).`,
        x:
"Planners should employ the MFD as a small workgroup asset, limiting concurrent network users and prioritizing direct-connected scanning for high-priority or time-sensitive tasks. Where high demand is expected, distribute load across multiple devices or designate separate devices for scanning versus printing to reduce contention."
      },
      p5: {
        g:
`Paragraph 5 — Likelihood of Occurrence.
Assess how likely the limitation is to manifest under expected operating conditions (particularly high-demand, multi-user network periods).`,
        x:
"This limitation is likely to occur in environments where the MFD is shared across multiple concurrent network users and shared destination services."
      },
      p6: {
        g:
`Paragraph 6 — Recommendation (TTP / planning integration).
State how this should inform deployment planning, TTP development, training, or procurement/scaling strategies.`,
        x:
"Incorporate this consideration into deployment planning guidance and local TTPs for office service continuity. Where sustained high demand is expected, plan for additional devices or architectural measures to distribute scanning and printing loads."
      }
    };

    /* ---------------- Inputs list ---------------- */
    const fields = ["refId","date","sutName","p1","p2","p3","p4","p5","p6"];

    function getForm(){
      const d = {};
      fields.forEach(k => d[k] = ($(k)?.value || "").trim());
      return d;
    }

    /* ---------------- Safe HTML + paragraph formatting ---------------- */
    function esc(s){
      return (s || "")
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;");
    }

    function para(text){
      const parts = (text || "").split(/\n\s*\n/).map(t => t.trim()).filter(Boolean);
      return parts.map(p => `<p>${esc(p)}</p>`).join("");
    }

    function guidanceBlock(g, x){
      return `
        <div class="guidance">${esc(g)}</div>
        <div class="context">${para(x)}</div>
      `;
    }

    /* ---------------- Advisory checks ---------------- */
    function setCheck(id, level, label){
      const el = $(id);
      if (!el) return;
      el.classList.remove("ok","warn","bad");
      el.classList.add(level);
      el.textContent = label;
    }

    function looksPastTense(s){
      const t = (s || "").toLowerCase();
      if (!t) return false;
      return /(\bwas\b|\bwere\b|\bobserved\b|\bexperienced\b|\bdegraded\b|\bincreased\b|\boccurred\b|\bresulted\b)/.test(t)
        || /\b\w+ed\b/.test(t);
    }

    function looksTactical(s){
      const t = (s || "").toLowerCase();
      if (!t) return false;
      return /\bplanner\b|\bplanning\b|\bemploy\b|\bemployment\b|\bdeploy\b|\bdistribution\b|\bredundanc\b|\bpriorit\b|\bworkgroup\b|\barchitecture\b|\bsegment\b/.test(t);
    }

    function runChecks(){
      const d = getForm();

      if (!d.p1) setCheck("chk1","warn","EMPTY");
      else if (looksPastTense(d.p1)) setCheck("chk1","ok","OK");
      else setCheck("chk1","warn","REVIEW");

      if (!d.p4) setCheck("chk4","warn","EMPTY");
      else if (looksTactical(d.p4)) setCheck("chk4","ok","OK");
      else setCheck("chk4","bad","ADD PLANNING");
    }

    /* ---------------- Preview renderer ---------------- */
    function renderPreviewHtml(){
      const d = getForm();

      const refId = esc(d.refId || "TACON-DEMO-XXX");
      const date = esc(d.date || "DD Mmm YYYY");

      const sutLine = generatedMode
        ? esc(d.sutName || GUIDANCE.sutName)
        : esc(GUIDANCE.sutName);

      const p1 = generatedMode
        ? (d.p1 ? para(d.p1) : `<p class="muted">[Paragraph 1 not entered]</p>`)
        : guidanceBlock(GUIDANCE.p1.g, GUIDANCE.p1.x);

      const p2 = generatedMode
        ? (d.p2 ? para(d.p2) : `<p class="muted">[Paragraph 2 not entered]</p>`)
        : guidanceBlock(GUIDANCE.p2.g, GUIDANCE.p2.x);

      const p3 = generatedMode
        ? (d.p3 ? para(d.p3) : `<p class="muted">[Paragraph 3 not entered]</p>`)
        : guidanceBlock(GUIDANCE.p3.g, GUIDANCE.p3.x);

      const p4 = generatedMode
        ? (d.p4 ? para(d.p4) : `<p class="muted">[Paragraph 4 not entered]</p>`)
        : guidanceBlock(GUIDANCE.p4.g, GUIDANCE.p4.x);

      const p5 = generatedMode
        ? (d.p5 ? para(d.p5) : `<p class="muted">[Paragraph 5 not entered]</p>`)
        : guidanceBlock(GUIDANCE.p5.g, GUIDANCE.p5.x);

      const p6 = generatedMode
        ? (d.p6 ? para(d.p6) : `<p class="muted">[Paragraph 6 not entered]</p>`)
        : guidanceBlock(GUIDANCE.p6.g, GUIDANCE.p6.x);

      return `
        <div class="topline">DRAFT</div>
        <div class="subline"><strong>TACTICAL CONSIDERATION (TACON)</strong></div>
        <div class="subline"><strong>REFERENCE:</strong> ${refId}</div>

        <div class="meta">
          <div><span class="muted">Date:</span> ${date}</div>
          <div><span class="muted">SUT:</span> ${sutLine}</div>
        </div>

        <div class="sect">
          <h3>1. OBSERVED TACTICAL PROBLEM.</h3>
          ${p1}
        </div>

        <div class="sect">
          <h3>2. CONDITIONS, EVENTS, AND ANALYSIS.</h3>
          ${p2}
        </div>

        <div class="sect">
          <h3>3. MISSION IMPACT.</h3>
          ${p3}
        </div>

        <div class="sect">
          <h3>4. TACTICAL RECOMMENDATION.</h3>
          ${p4}
        </div>

        <div class="sect">
          <h3>5. LIKELIHOOD OF OCCURRENCE.</h3>
          ${p5}
        </div>

        <div class="sect">
          <h3>6. RECOMMENDATION.</h3>
          ${p6}
        </div>
      `;
    }

    function setMode(isGenerated){
      generatedMode = !!isGenerated;
      const badge = $("modeBadge");
      if (badge) badge.textContent = generatedMode ? "GENERATED (Guidance Hidden)" : "DRAFT (Guidance Visible)";
    }

    function renderPreview(){
      const host = $("previewHost");
      if (!host) return;
      host.innerHTML = renderPreviewHtml();
      runChecks();
    }

    /* ---------------- Reset ---------------- */
    function resetAll(){
      fields.forEach(k => { const el = $(k); if (el) el.value = ""; });
      setMode(false);
      // Preload demo SUT for convenience
      $("sutName").value = GUIDANCE.sutName;
      renderPreview();
    }

    /* ---------------- Save to DOCX (demo) ---------------- */
    function saveToDocxDemo(){
      const previewHtml = $("previewHost") ? $("previewHost").innerHTML : "";

      const doc =
`<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>TACON Export</title>
<style>
  body{ font-family: "Times New Roman", Times, serif; }
  .page{ width: ${esc(getComputedStyle(document.documentElement).getPropertyValue("--page-w").trim() || "8.5in")}; }
  .margins{ padding: ${esc(getComputedStyle(document.documentElement).getPropertyValue("--margin").trim() || "1in")}; }
  .sect{ max-width: ${esc(getComputedStyle(document.documentElement).getPropertyValue("--usable-w").trim() || "6.5in")}; }
</style>
</head>
<body>
  <div class="page">
    <div class="margins">
      ${previewHtml}
    </div>
  </div>
</body>
</html>`;

      const blob = new Blob([doc], { type: "application/msword" });

      const d = getForm();
      const fname = (d.refId || "TACON") + ".doc";
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = fname.replace(/[^\w.\-]+/g, "_");
      document.body.appendChild(a);
      a.click();
      setTimeout(() => { URL.revokeObjectURL(a.href); a.remove(); }, 500);
    }

    /* ---------------- Nav (Back) ---------------- */
    function goBack(){
      window.location.href = "./index.html";
    }

    /* ---------------- Event wiring ---------------- */
    function wireEvents(){
      $("btnBack")?.addEventListener("click", (e) => { e.preventDefault(); goBack(); });

      $("btnGenerate")?.addEventListener("click", (e) => {
        e.preventDefault();
        setMode(true);
        renderPreview();
      });

      $("btnReset")?.addEventListener("click", (e) => {
        e.preventDefault();
        resetAll();
      });

      $("btnSave")?.addEventListener("click", (e) => {
        e.preventDefault();
        saveToDocxDemo();
      });

      // Advisory checks update while typing; preview stays stable until Generate
      ["p1","p4"].forEach(id => {
        $(id)?.addEventListener("input", runChecks);
        $(id)?.addEventListener("change", runChecks);
      });
    }

    function init(){
      setMode(false);
      $("sutName").value = GUIDANCE.sutName;
      renderPreview();
      wireEvents();
      runChecks();
    }

    init();
  })();
  </script>
</body>
</html>
